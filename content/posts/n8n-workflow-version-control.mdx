---
title: åœ¨è‡ªå»º n8n ç‚º Workflow å»ºç‰ˆæ§ï¼šè‡ªå‹•åŒæ­¥åˆ° GitLabï¼ˆCreate / Edit ç¯€é»ï¼‰
description: ä»¥è‡ªå»ºçš„ n8n ç‚ºæ ¸å¿ƒï¼Œé€é HTTP å–å› Workflowã€æ•´ç†æ¬„ä½å¾Œæ¨é€è‡³ GitLabï¼Œå¯¦ä½œã€ŒCreate File / Edit Fileã€å…©æ¢ç‰ˆæ§æµç¨‹ï¼›å…§å« API é‡‘é‘°è¨­å®šã€GitLab PAT æ¬Šé™ã€é¿å…ç©ºæäº¤èˆ‡å®Œæ•´ workflow JSONã€‚
date: 2025-10-27 10:00:00 +0800
categories: [Blog, TechLog]
tags: [n8n, GitLab, VersionControl, DevSecOps, Automation, HTTP, PAT, Workflow]
---

## TL;DR
åœ¨è‡ªå»ºçš„ N8N å° Workflow ç‰ˆæ§ï¼Œæ¨ä¸Š Gitlab

## èƒŒæ™¯
å»¶çºŒä¸Šç¯‡ã€ˆ[ç”¨ n8n è‡ªå‹•è¿½è¹¤å·¥å…·æ›´æ–°ä¸¦ç™¼é€ Slack é€šçŸ¥ï¼šé–‹ç™¼ä¾è³´å®‰å…¨ç›£æ§æµç¨‹å¯¦ä½œ](https://blog.cosparks.app/posts/n8n-engineering-automation/)ã€‰ï¼Œé–‹å§‹å»ºç«‹ Workflow å¾Œå¯ä»¥
- å° Workflow åš**ç‰ˆæœ¬ç‰ˆæ§**ã€‚
- è®“æ¯æ¬¡è®Šæ›´éƒ½èƒ½è¢«è¿½è¹¤ã€æ¯”å°èˆ‡å›æ»¾ã€‚

### ç‰ˆæ§æµç¨‹æ¦‚è¦½
![flow](../assets/post/n8n-workflow-version-control/flow.png)
- å…©æ¢æµç¨‹å¹¾ä¹ç›¸åŒï¼Œåªå·®åœ¨ **GitLab ç¯€é»**ï¼šä¸€æ¢ç”¨ **Create File**ã€å¦ä¸€æ¢ç”¨ **Edit File**ã€‚  
- å…ˆç”¨ **HTTP Request** å‘è‡ªæ¶ n8n å–å¾— `workflows` JSONï¼Œç¶“éæ¬„ä½æ¸…æ´—ï¼ˆSplit / Set / Codeï¼‰ï¼Œå†é€åˆ° GitLabã€‚  

### N8N workflow è³‡æ–™å–å¾—

> åœ¨å·¦ä¸‹è§’çš„ Settings å…§æ‰¾åˆ° Api ä¸¦é»æ“Š `Create an API Key` ä¾†å»ºç«‹ n8n API Key
> ç”¢ç”Ÿå¾Œåªæœƒé¡¯ç¤ºä¸€æ¬¡ï¼Œè«‹å¦¥å–„ä¿å­˜(é›¢é–‹é é¢å¾Œå°±çœ‹ä¸åˆ°)

![token1](../assets/post/n8n-workflow-version-control/token1.png)

å»ºç«‹è³‡æ–™å–å¾—çš„ç¯€é» (HTTP Request)
> åˆ†åˆ¥éœ€è¦è¨­ç½® Request & Headers (ä¸‹é¢çš„åœ¨å®Œæˆ Demo å¾Œå·²åˆªé™¤)<br/>
> `accept: aaplication/json`<br/>
> `X-N8N-API-KEY: {$your-n8n-api-key}`

![token2](../assets/post/n8n-workflow-version-control/token2.png)
![token3](../assets/post/n8n-workflow-version-control/token3.png)

è³‡æ–™å–å¾—æ¸¬è©¦
![fetch](../assets/post/n8n-workflow-version-control/fetch.png)

### Gitlab PAT å»ºç«‹

> `Add new token` çµ¦äºˆ `api`, `write_repository`, `read_repository`

![gitlab-PAT](../assets/post/n8n-workflow-version-control/gitlab-PAT.png)

> åœ¨ N8N çš„ `Gitlab ç¯€é»` å»ºç«‹ `Credential`
> å¡«å…¥ `Gitlab Server` èˆ‡å‰›å‰›çš„ `Access Token`

![new-workflow1](../assets/post/n8n-workflow-version-control/new-workflow1.png)
![new-workflow2](../assets/post/n8n-workflow-version-control/new-workflow2.png)

> `Edit è¡Œç‚ºé©—è­‰`ï¼šç„¡æª”æ¡ˆç•°å‹•æ™‚ï¼Œä¸æœƒæ¨ Commit

![result](../assets/post/n8n-workflow-version-control/result.png)

### ç‰ˆæ§ workflow ç¯„ä¾‹
```json
{
    "createdAt": "2025-10-17T07:48:49.406Z",
    "updatedAt": "2025-10-17_08:43:41",
    "id": "d0KEcmHhtWoSb7QV",
    "name": "version-control",
    "active": false,
    "nodes": [
      {
        "parameters": {},
        "name": "æ‰‹å‹•è§¸ç™¼",
        "type": "n8n-nodes-base.manualTrigger",
        "typeVersion": 1,
        "position": [
          200,
          80
        ],
        "id": "5d1c9515-1f9e-4037-9b5d-93b18c4a49a3"
      },
      {
        "parameters": {
          "fieldToSplitOut": "data",
          "include": "allOtherFields",
          "options": {}
        },
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          640,
          80
        ],
        "id": "8a753163-c45f-4e62-9066-9c48d180b36e",
        "name": "Split Out"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "6cf83cea-8398-4af7-baba-89146ed9b7ff",
                "name": "name",
                "value": "={{ $json.data.name }}",
                "type": "string"
              },
              {
                "id": "48e48f8d-6d17-4e08-99ca-368028cce60e",
                "name": "filename",
                "value": "={{ 'workflows_'+ $json.data.name }}",
                "type": "string"
              },
              {
                "id": "7ec7c64e-782a-4204-9f97-6d7a7a7ccdda",
                "name": "versionId",
                "value": "={{ $json.data.versionId }}",
                "type": "string"
              },
              {
                "id": "40d5161f-fc07-4e11-9bdd-145a8de3d0aa",
                "name": "data",
                "value": "={{ $json.data }}",
                "type": "object"
              },
              {
                "id": "8093b35c-0ec2-46c3-91c7-b2b8e458b2e4",
                "name": "date",
                "value": "={{ $now.setZone('Asia/Taipei').toFormat('yyyy-LL-dd') }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          860,
          80
        ],
        "id": "c218324c-614f-4083-8051-0e9bded46c49",
        "name": "Edit Fields"
      },
      {
        "parameters": {
          "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  const date = new Date(item.json.data.updatedAt);\n  \n  const yyyy = date.getFullYear();\n  const MM = String(date.getMonth() + 1).padStart(2, '0');\n  const dd = String(date.getDate()).padStart(2, '0');\n  const hh = String(date.getHours()).padStart(2, '0');\n  const mm = String(date.getMinutes()).padStart(2, '0');\n  const ss = String(date.getSeconds()).padStart(2, '0');\n  \n  item.json.data.updatedAt = `${yyyy}-${MM}-${dd}_${hh}:${mm}:${ss}`;\n}\nreturn $input.all();"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1080,
          80
        ],
        "id": "bbb3e39a-d86e-4977-96b8-01e41617fe6a",
        "name": "æ—¥æœŸè½‰æ›ç‚º yyyy-MM-dd_hh:mm:ss"
      },
      {
        "parameters": {
          "url": "http://127.0.0.1:5678/api/v1/workflows",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "accept",
                "value": "application/json"
              },
              {
                "name": "X-N8N-API-KEY",
                "value": ""
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          420,
          80
        ],
        "id": "4a4b8f66-c971-41e8-ac66-cdb069860a0f",
        "name": "å–è³‡æ–™"
      },
      {
        "parameters": {
          "resource": "file",
          "owner": "going-cloud/team/sre",
          "repository": "toolbox",
          "filePath": "={{ 'n8n-workflows/'+$json.name + '.json' }}",
          "fileContent": "={{ JSON.stringify($json.data) }}",
          "commitMessage": "={{ 'feat: add workflow \"' + $json.data.name + '\", createTime: ' + $json.data.updatedAt }}",
          "branch": "n8n"
        },
        "type": "n8n-nodes-base.gitlab",
        "typeVersion": 1,
        "position": [
          1300,
          80
        ],
        "id": "e27d051b-b40a-4779-8e55-c660d552da9b",
        "name": "æ¨æª”æ¡ˆ1",
        "retryOnFail": true,
        "credentials": {
          "gitlabApi": {
            "id": "FKWnY3maIfc2FxZ4",
            "name": "GitLab account"
          }
        }
      },
      {
        "parameters": {
          "fieldToSplitOut": "data",
          "include": "allOtherFields",
          "options": {}
        },
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          640,
          280
        ],
        "id": "cf7bb454-9175-4176-8ee2-f64274e03d73",
        "name": "Split Out2"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "6cf83cea-8398-4af7-baba-89146ed9b7ff",
                "name": "name",
                "value": "={{ $json.data.name }}",
                "type": "string"
              },
              {
                "id": "48e48f8d-6d17-4e08-99ca-368028cce60e",
                "name": "filename",
                "value": "={{ 'workflows_'+ $json.data.name }}",
                "type": "string"
              },
              {
                "id": "7ec7c64e-782a-4204-9f97-6d7a7a7ccdda",
                "name": "versionId",
                "value": "={{ $json.data.versionId }}",
                "type": "string"
              },
              {
                "id": "40d5161f-fc07-4e11-9bdd-145a8de3d0aa",
                "name": "data",
                "value": "={{ $json.data }}",
                "type": "object"
              },
              {
                "id": "8093b35c-0ec2-46c3-91c7-b2b8e458b2e4",
                "name": "date",
                "value": "={{ $now.setZone('Asia/Taipei').toFormat('yyyy-LL-dd') }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          860,
          280
        ],
        "id": "ed1a1c9a-1674-43fe-8b90-289c2f575b64",
        "name": "Edit Fields2"
      },
      {
        "parameters": {
          "jsCode": "// Loop over input items and add a new field called 'myNewField' to the JSON of each one\nfor (const item of $input.all()) {\n  const date = new Date(item.json.data.updatedAt);\n  \n  const yyyy = date.getFullYear();\n  const MM = String(date.getMonth() + 1).padStart(2, '0');\n  const dd = String(date.getDate()).padStart(2, '0');\n  const hh = String(date.getHours()).padStart(2, '0');\n  const mm = String(date.getMinutes()).padStart(2, '0');\n  const ss = String(date.getSeconds()).padStart(2, '0');\n  \n  item.json.data.updatedAt = `${yyyy}-${MM}-${dd}_${hh}:${mm}:${ss}`;\n}\nreturn $input.all();"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1080,
          280
        ],
        "id": "fe2dee64-19e5-46be-bd0a-d434b8ba8e2f",
        "name": "æ—¥æœŸè½‰æ›ç‚º yyyy-MM-dd_hh:mm:ss2"
      },
      {
        "parameters": {
          "url": "http://127.0.0.1:5678/api/v1/workflows",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "accept",
                "value": "application/json"
              },
              {
                "name": "X-N8N-API-KEY",
                "value": ""
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          420,
          280
        ],
        "id": "e29ddfc3-966d-436e-beba-eb08c5be3258",
        "name": "å–è³‡æ–™1"
      },
      {
        "parameters": {
          "resource": "file",
          "operation": "edit",
          "owner": "going-cloud/team/sre",
          "repository": "toolbox",
          "filePath": "={{ 'n8n-workflows/'+$json.name + '.json' }}",
          "fileContent": "={{ JSON.stringify($json.data) }}",
          "commitMessage": "={{ 'feat: add workflow \"' + $json.data.name + '\", createTime: ' + $json.data.updatedAt }}",
          "branch": "n8n"
        },
        "type": "n8n-nodes-base.gitlab",
        "typeVersion": 1,
        "position": [
          1300,
          280
        ],
        "id": "13daaf78-d576-40fb-b9bf-8ae32a1d1a0e",
        "name": "æ¨æª”æ¡ˆ2",
        "retryOnFail": true,
        "credentials": {
          "gitlabApi": {
            "id": "FKWnY3maIfc2FxZ4",
            "name": "GitLab account"
          }
        }
      }
    ],
    "connections": {
      "æ‰‹å‹•è§¸ç™¼": {
        "main": [
          [
            {
              "node": "å–è³‡æ–™",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out": {
        "main": [
          [
            {
              "node": "Edit Fields",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields": {
        "main": [
          [
            {
              "node": "æ—¥æœŸè½‰æ›ç‚º yyyy-MM-dd_hh:mm:ss",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "æ—¥æœŸè½‰æ›ç‚º yyyy-MM-dd_hh:mm:ss": {
        "main": [
          [
            {
              "node": "æ¨æª”æ¡ˆ1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "å–è³‡æ–™": {
        "main": [
          [
            {
              "node": "Split Out",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out2": {
        "main": [
          [
            {
              "node": "Edit Fields2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Edit Fields2": {
        "main": [
          [
            {
              "node": "æ—¥æœŸè½‰æ›ç‚º yyyy-MM-dd_hh:mm:ss2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "æ—¥æœŸè½‰æ›ç‚º yyyy-MM-dd_hh:mm:ss2": {
        "main": [
          [
            {
              "node": "æ¨æª”æ¡ˆ2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "å–è³‡æ–™1": {
        "main": [
          [
            {
              "node": "Split Out2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
      "templateCredsSetupCompleted": true
    },
    "pinData": {},
    "triggerCount": 0,
    "tags": []
  }
```

---
ğŸ“Œ é—œéµå­—ï¼šn8nã€Workflow ç‰ˆæ§ã€GitLabã€Personal Access Tokenã€HTTP Requestã€API Keyã€è‡ªå‹•åŒ–å‚™ä»½ã€DevSecOpsã€Create Fileã€Edit Fileã€é¿å…ç©ºæäº¤
